name: Flutter Build and Release (Fixed)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    # Flutter Ù…Ø§Ø­ÙˆÙ„ Ú©Ùˆ Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº
    - name: Set up Flutter
      uses: subosito/flutter-action@v2
      with:
        # Ø§Ù¾Ù†Û’ Ù…Ø·Ù„ÙˆØ¨Û ÙˆØ±Ú˜Ù† Ú©Ùˆ Ø§ÛŒÚˆØ¬Ø³Ù¹ Ú©Ø±ÛŒÚº
        flutter-version: '3.19.x' 
        channel: 'stable'

    # --- Dependencies Ù…Ø±Ø­Ù„Û ---
    - name: Get Dependencies (flutter pub get)
      # Working Directory Ú©Ø§ ÙÚ©Ø³
      working-directory: ./DigitalWaqt_Azan_Full
      run: flutter pub get
      # Shell Ú©Ø§ ÙÚ©Ø³
      shell: /bin/sh -c "{0}" 

    # --- Build Ù…Ø±Ø­Ù„Û ---
    - name: Build Android APK
      # Working Directory Ú©Ø§ ÙÚ©Ø³
      working-directory: ./DigitalWaqt_Azan_Full
      run: flutter build apk --release
      shell: /bin/sh -c "{0}" 
      
    # --- Upload Artifact Ù…Ø±Ø­Ù„Û ---
    - name: Upload APK Artifact
      # ğŸ’¥ ØªØ§Ø²Û ØªØ±ÛŒÙ† ÙˆØ±Ú˜Ù† v4 Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº (Deprecated v3 Ø³Û’ Ø¨Ú†Ù†Û’ Ú©Û’ Ù„ÛŒÛ’)
      uses: actions/upload-artifact@v4 
      with:
        name: release-apk
        path: ./DigitalWaqt_Azan_Full/build/app/outputs/flutter-apk/app-release.apk
        # v4 Ù…ÛŒÚº Ø§ÛŒÚ© Ù†ÛŒØ§ Ù¾ÛŒØ±Ø§Ù…ÛŒÙ¹Ø± Ø¬ÙˆÚ‘Ù†Ø§ Ù…ÙÛŒØ¯ ÛÛ’
        retention-days: 7
